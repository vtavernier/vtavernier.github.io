<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=content-language content="en"><meta name=author content="Vincent Tavernier"><meta name=description content="hyperion.rs          hyperion.rs is a Rust implementation of the Hyperion open-source ambient lighting software.
 hyperiond/ : daemon program and usage instructions hyperion/ : core functionality implementation  Requirements  Rust stable  protobuf compiler , protobuf-compiler on Debian distributions  Usage Get the source for the project:
git clone https://github.com/vtavernier/hyperion.rs.git cd hyperion.rs Assuming the following config.yml:
devices: - name: Raw UDP device frequency: 30 # Hz idle: delay: 5s # Consider device idle after 5s holds: true # This device holds the last command forever retries: 3 # Unreliable device, retry sending packets 3 times during idle updates endpoint: type: udp address: 192."><meta name=keywords content="blog,developer,personal,research,graphics"><meta name=twitter:card content="summary"><meta name=twitter:title content="hyperion.rs"><meta name=twitter:description content="hyperion.rs          hyperion.rs is a Rust implementation of the Hyperion open-source ambient lighting software.
 hyperiond/ : daemon program and usage instructions hyperion/ : core functionality implementation  Requirements  Rust stable  protobuf compiler , protobuf-compiler on Debian distributions  Usage Get the source for the project:
git clone https://github.com/vtavernier/hyperion.rs.git cd hyperion.rs Assuming the following config.yml:
devices: - name: Raw UDP device frequency: 30 # Hz idle: delay: 5s # Consider device idle after 5s holds: true # This device holds the last command forever retries: 3 # Unreliable device, retry sending packets 3 times during idle updates endpoint: type: udp address: 192."><meta property="og:title" content="hyperion.rs"><meta property="og:description" content="hyperion.rs          hyperion.rs is a Rust implementation of the Hyperion open-source ambient lighting software.
 hyperiond/ : daemon program and usage instructions hyperion/ : core functionality implementation  Requirements  Rust stable  protobuf compiler , protobuf-compiler on Debian distributions  Usage Get the source for the project:
git clone https://github.com/vtavernier/hyperion.rs.git cd hyperion.rs Assuming the following config.yml:
devices: - name: Raw UDP device frequency: 30 # Hz idle: delay: 5s # Consider device idle after 5s holds: true # This device holds the last command forever retries: 3 # Unreliable device, retry sending packets 3 times during idle updates endpoint: type: udp address: 192."><meta property="og:type" content="article"><meta property="og:url" content="https://vtavernier.github.io/projects/hyperion.rs/"><title>hyperion.rs Â· The Tavern</title><link rel=canonical href=https://vtavernier.github.io/projects/hyperion.rs/><link rel=preconnect href=https://fonts.gstatic.com><link href="https://fonts.googleapis.com/css?family=Lato:400,700%7CMerriweather:300,700%7CSource+Code+Pro:400,700&display=swap" rel=stylesheet><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/fork-awesome@1.1.7/css/fork-awesome.min.css integrity="sha256-gsmEoJAws/Kd3CjuOQzLie5Q3yshhvmo7YNtBG7aaEY=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/normalize.css@8/normalize.min.css><link rel=stylesheet href=/css/coder.min.f01c647a0d25b40da992a37c3376291185eed8a50ced8c26cc2c0bcfe38c97df.css integrity="sha256-8Bxkeg0ltA2pkqN8M3YpEYXu2KUM7YwmzCwLz+OMl98=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/coder-dark.min.126ad3988d46bdae6217a11105b53c9662bca05f39d42d3c0fb366919d334620.css integrity="sha256-EmrTmI1Gva5iF6ERBbU8lmK8oF851C08D7NmkZ0zRiA=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/main.css><link rel=icon type=image/png href=/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/images/favicon-16x16.png sizes=16x16><link rel=apple-touch-icon href=/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png><script defer src=https://twemoji.maxcdn.com/v/13.0.1/twemoji.min.js integrity=sha384-5f4X0lBluNY/Ib4VhGx0Pf6iDCF99VGXJIyYy7dDLY5QlEd7Ap0hICSSZA1XYbc4 crossorigin=anonymous></script><meta name=generator content="Hugo 0.75.1"></head><body class=colorscheme-dark onload=twemoji.parse(document.body);><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=/>The Tavern</a>
<input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/posts/>Blog</a></li><li class=navigation-item><a class=navigation-link href=/projects/>Projects</a></li><li class=navigation-item><a class=navigation-link href=/research/>Research</a></li></ul></section></nav><div class=content><section class="container page"><article><header><h1><a href=https://github.com/vtavernier/hyperion.rs>hyperion.rs</a></h1></header><p><a href=http://travis-ci.com/vtavernier/hyperion.rs target=_blank rel=noopener><img src=https://travis-ci.com/vtavernier/hyperion.rs.svg alt="Build Status"></a>
<a href=https://github.com/vtavernier/hyperion.rs/releases target=_blank rel=noopener><img src=https://img.shields.io/github/release/vtavernier/hyperion.rs alt="GitHub release"></a>
<a href="https://www.codacy.com/app/vtavernier/hyperion.rs?utm_source=github.com&amp;amp;utm_medium=referral&amp;amp;utm_content=vtavernier/hyperion.rs&amp;amp;utm_campaign=Badge_Grade" target=_blank rel=noopener><img src=https://api.codacy.com/project/badge/Grade/9a0bff1adfc84e1d8c72fcc136328629 alt="Codacy Badge"></a>
<a href=https://vtavernier.github.io/hyperion.rs/ target=_blank rel=noopener><img src=https://img.shields.io/badge/docs-master-blue.svg alt=Documentation></a>
<a href=https://opensource.org/licenses/MIT target=_blank rel=noopener><img src=https://img.shields.io/badge/License-MIT-blue.svg alt="License: MIT"></a>
<a href=https://libraries.io/github/vtavernier/hyperion.rs target=_blank rel=noopener><img src=https://img.shields.io/librariesio/github/vtavernier/hyperion.rs.svg alt="Libraries.io for GitHub"></a>
<a href=https://sagiegurari.github.io/cargo-make target=_blank rel=noopener><img src=https://sagiegurari.github.io/cargo-make/assets/badges/cargo-make.svg alt="Built with cargo-make"></a></p><p><code>hyperion.rs</code> is a Rust implementation of the
<a href=https://github.com/hyperion-project/hyperion target=_blank rel=noopener>Hyperion</a>
open-source ambient
lighting software.</p><ul><li><a href=https://github.com/vtavernier/hyperion.rs/blob/master/hyperiond target=_blank rel=noopener><code>hyperiond/</code></a>
: daemon program and usage instructions</li><li><a href=https://github.com/vtavernier/hyperion.rs/blob/master/hyperion target=_blank rel=noopener><code>hyperion/</code></a>
: core functionality implementation</li></ul><h2 id=requirements>Requirements</h2><ul><li><a href=https://rustup.rs/ target=_blank rel=noopener>Rust stable</a></li><li><a href=https://github.com/protocolbuffers/protobuf/releases target=_blank rel=noopener>protobuf compiler</a>
, <code>protobuf-compiler</code> on Debian distributions</li></ul><h2 id=usage>Usage</h2><p>Get the source for the project:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>git clone https://github.com/vtavernier/hyperion.rs.git
<span style=color:#8be9fd;font-style:italic>cd</span> hyperion.rs
</code></pre></div><p>Assuming the following <code>config.yml</code>:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#ff79c6>devices</span>:
  - <span style=color:#ff79c6>name</span>: Raw UDP device
    <span style=color:#ff79c6>frequency</span>: <span style=color:#bd93f9>30</span> <span style=color:#6272a4># Hz</span>
    <span style=color:#ff79c6>idle</span>:
      <span style=color:#ff79c6>delay</span>: 5s   # Consider device idle after 5s
      <span style=color:#ff79c6>holds</span>: <span style=color:#ff79c6>true</span> <span style=color:#6272a4># This device holds the last command forever</span>
      <span style=color:#ff79c6>retries</span>: <span style=color:#bd93f9>3</span>  <span style=color:#6272a4># Unreliable device, retry sending packets 3 times during idle updates</span>
    <span style=color:#ff79c6>endpoint</span>:
      <span style=color:#ff79c6>type</span>: udp
      <span style=color:#ff79c6>address</span>: <span style=color:#bd93f9>192.168.0.27</span>:<span style=color:#bd93f9>19446</span> <span style=color:#6272a4># Can also use hostnames, e.g. device.local:19446</span>
    <span style=color:#ff79c6>leds</span>:
      <span style=color:#6272a4># When facing the screen</span>
      <span style=color:#6272a4>#  * hscan ranges from 0 (left) to 1 (right)</span>
      <span style=color:#6272a4>#  * vscan ranges from 0 (top) to 1 (bottom)</span>
      - <span style=color:#ff79c6>hscan</span>: { <span style=color:#ff79c6>min: 0.8, max</span>: <span style=color:#bd93f9>1.0</span> }
        <span style=color:#ff79c6>vscan</span>: { <span style=color:#ff79c6>min: 0.0, max</span>: <span style=color:#bd93f9>1.0</span> }
      - <span style=color:#ff79c6>hscan</span>: { <span style=color:#ff79c6>min: 0.5, max</span>: <span style=color:#bd93f9>1.0</span> }
        <span style=color:#ff79c6>vscan</span>: { <span style=color:#ff79c6>min: 0.0, max</span>: <span style=color:#bd93f9>0.2</span> }
      - <span style=color:#ff79c6>hscan</span>: { <span style=color:#ff79c6>min: 0.0, max</span>: <span style=color:#bd93f9>0.5</span> }
        <span style=color:#ff79c6>vscan</span>: { <span style=color:#ff79c6>min: 0.0, max</span>: <span style=color:#bd93f9>0.2</span> }
      - <span style=color:#ff79c6>hscan</span>: { <span style=color:#ff79c6>min: 0.0, max</span>: <span style=color:#bd93f9>0.2</span> }
        <span style=color:#ff79c6>vscan</span>: { <span style=color:#ff79c6>min: 0.0, max</span>: <span style=color:#bd93f9>1.0</span> }
</code></pre></div><p>You can run the daemon using the following commands:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#6272a4># Build and run</span>
<span style=color:#8be9fd;font-style:italic>HYPERION_LOG</span><span style=color:#ff79c6>=</span><span style=color:#8be9fd;font-style:italic>hyperion</span><span style=color:#ff79c6>=</span>debug cargo run -- -c config.yml s --bind 0.0.0.0
<p><span style=color:#6272a4># Run release version (without cargo)</span>
<span style=color:#8be9fd;font-style:italic>HYPERION_LOG</span><span style=color:#ff79c6>=</span><span style=color:#8be9fd;font-style:italic>hyperion</span><span style=color:#ff79c6>=</span>debug ./target/release/hyperiond -c config.yml s &ndash;bind 0.0.0.0
</code></pre></div><p>The Android app can be used to send commands to this server, which should result
in updated colors in the output of the daemon.</p></p><p>If you have <a href=https://github.com/sagiegurari/cargo-make target=_blank rel=noopener>cargo-make</a>
installed,
you can use this command to build a deployable archive of hyperion.rs:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#6272a4># Build hyperion.rs-release.tar.gz</span>
cargo make --no-workspace package-release
</code></pre></div><h2 id=status>Status</h2><p>This is still early work: the crate interface will probably change a lot and the
configuration format might be updated in breaking ways.</p><p>Not implemented yet:</p><ul><li>Effects</li><li>Other LED device types</li></ul><h3 id=supported-devices>Supported devices</h3><p>This list details which devices are supported currently for outputting color data.</p><ul><li>Raw 8-bit RGB UDP</li><li>Stdout (for debugging)</li></ul><p>Currently, both RGB and RGB+W LED arrangements are supported. The white component
is computed from the RGB commands sent to the daemon, based on the white point
(color temperature) of both the devices' RGB and W LEDs. This means that the W
LED will be used to produce as much as possible of its &ldquo;target&rdquo; white, while the
RGB LED will be used for colors, while also having its white point corrected.
This requires estimating (or getting from the specs) the color temperature of
the various LEDs in the device.</p><p>RGBCW (RGB + Cold white + Warm white) is not supported yet and only the RGB LED
will be used.</p><h3 id=endpoint-command-status>Endpoint command status</h3><p>This table summarizes the commands supported by the JSON and Protobuf interfaces
to the Hyperion server.</p><table><thead><tr><th>Command</th><th>JSON</th><th>Protobuf</th></tr></thead><tbody><tr><td>Adjustment</td><td>â</td><td>N.A.</td></tr><tr><td>Clear</td><td>â</td><td>â</td></tr><tr><td>ClearAll</td><td>â</td><td>â</td></tr><tr><td>Color</td><td>â</td><td>â</td></tr><tr><td>Correction</td><td>â</td><td>N.A.</td></tr><tr><td>Effect</td><td>â</td><td>N.A.</td></tr><tr><td>Image</td><td>â</td><td>â</td></tr><tr><td>ServerInfo</td><td>â</td><td>N.A.</td></tr><tr><td>Temperature</td><td>â</td><td>N.A.</td></tr><tr><td>Transform</td><td>â</td><td>N.A.</td></tr></tbody></table><ul><li>N.A.: not defined for the protocol</li></ul><h3 id=image-processing>Image processing</h3><p>The black border detector has not been implemented yet.</p><h3 id=color-processing>Color processing</h3><p>The Hyperion daemon is responsible for processing the incoming image data into
LED colors. This requires processing and transforming colors. The following parts
of the color processing pipeline have been implemented:</p><p><em>(none)</em></p><p>The following parts have to be implemented (they are listed in order of application
in the computation):</p><ul><li>Transform (saturation gain, luminance gain, luminance minimum + RGB per-channel
threshold and gamma)</li><li>Adjustment (RGB -> RGB mapping matrix)</li><li>Temperature (RGB per-channel multiplication)</li></ul><h3 id=effects>Effects</h3><p>Effects in hyperion.rs will be implemented as Lua scripts with a specific API to
interact with hyperiond. This project uses the Lua interpreter as it is lighter
to embed than the Python interpreter, and the language differences should not
matter much for writing effect code.</p><p>Effect support is under development.</p><h3 id=smoothing>Smoothing</h3><p>The following temporal filters are available:</p><ul><li><code>nearest</code>: no filtering. The latest image sample is used as current color.
Lowest image to LED latency, but sensitive to noise.</li><li><code>linear</code>: linear filtering. The LED color reaches the latest image sample
linearly in <code>1/f</code> seconds (where <code>f</code> is the filter frequency). Introduces
latency proportional to the filter period.</li></ul><h3 id=grabbing>Grabbing</h3><p>Grabbing is not planned yet for hyperion.rs.</p><h3 id=web-configuration>Web configuration</h3><p>Web configuration of the hyperion.rs is outside of the scope of this project.</p><h2 id=authors>Authors</h2><ul><li><a href=https://github.com/vtavernier target=_blank rel=noopener>Vincent Tavernier</a></li></ul><h2 id=license>License</h2><p>This source code is released under the <a href=https://opensource.org/licenses/MIT target=_blank rel=noopener>MIT-License</a></p></article></section></div><footer class=footer><section class=container><p>This work is licensed under a Creative Commons Attribution-ShareAlike 4.0 International License.</p>Â©
2019 -
2020
Vincent Tavernier
Â·
Powered by <a href=https://gohugo.io/>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/>Coder</a>.</section></footer></main></body></html>